<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CryptoDen | Settings</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
            color: #f1f5f9;
        }
        
        .main-container {
            padding: 16px;
            padding-bottom: 100px;
            max-width: 500px;
            margin: 0 auto;
        }
        
        /* Header */
        .header {
            text-align: center;
            padding: 20px 0;
        }
        
        .logo {
            font-size: 48px;
            margin-bottom: 8px;
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #60a5fa, #34d399);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header p {
            color: #94a3b8;
            font-size: 13px;
        }
        
        /* Status Card */
        .status-card {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(71, 85, 105, 0.5);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
        }
        
        .status-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ef4444;
        }
        
        .status-dot.running {
            background: #22c55e;
            box-shadow: 0 0 12px rgba(34, 197, 94, 0.5);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .status-text {
            font-size: 18px;
            font-weight: 600;
        }
        
        .status-info {
            display: flex;
            justify-content: center;
            gap: 16px;
            font-size: 12px;
            color: #94a3b8;
            flex-wrap: wrap;
        }
        
        .main-btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 16px;
            transition: all 0.3s;
        }
        
        .main-btn.start {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
        }
        
        .main-btn.stop {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .main-btn:disabled {
            background: #475569;
            color: #94a3b8;
            cursor: not-allowed;
        }
        
        /* Cards */
        .card {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(71, 85, 105, 0.4);
            border-radius: 16px;
            margin-bottom: 12px;
            overflow: hidden;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            cursor: pointer;
        }
        
        .card-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
        }
        
        .card-title h3 {
            font-size: 15px;
            font-weight: 600;
        }
        
        .card-title .subtitle {
            font-size: 11px;
            color: #94a3b8;
        }
        
        .card-arrow {
            color: #64748b;
            transition: transform 0.3s;
        }
        
        .card.open .card-arrow {
            transform: rotate(180deg);
        }
        
        .card-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .card.open .card-content {
            max-height: 800px;
        }
        
        .card-body {
            padding: 0 16px 16px;
        }
        
        /* API Inputs */
        .input-group {
            margin-bottom: 12px;
        }
        
        .input-group label {
            display: block;
            font-size: 12px;
            color: #94a3b8;
            margin-bottom: 6px;
        }
        
        .input-wrapper {
            position: relative;
        }
        
        .input-wrapper input {
            width: 100%;
            padding: 12px;
            padding-right: 44px;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid #475569;
            border-radius: 10px;
            color: #f1f5f9;
            font-size: 14px;
        }
        
        .input-wrapper input:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        .input-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
            font-size: 16px;
        }
        
        /* Toggle Buttons */
        .toggle-row {
            display: flex;
            gap: 8px;
        }
        
        .toggle-btn {
            flex: 1;
            padding: 12px;
            border: 1px solid #475569;
            border-radius: 10px;
            background: rgba(15, 23, 42, 0.6);
            color: #94a3b8;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .toggle-btn.active {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }
        
        .toggle-btn.active.danger {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }
        
        /* Module Modes */
        .module-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 10px;
            margin-bottom: 8px;
        }
        
        .module-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .module-icon {
            font-size: 20px;
        }
        
        .module-name {
            font-size: 14px;
            font-weight: 500;
        }
        
        .module-desc {
            font-size: 10px;
            color: #64748b;
        }
        
        .mode-toggle {
            display: flex;
            gap: 4px;
        }
        
        .mode-btn {
            padding: 6px 12px;
            border: 1px solid #475569;
            border-radius: 6px;
            background: transparent;
            color: #64748b;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .mode-btn.active {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.3);
            color: #60a5fa;
        }
        
        .mode-btn.auto.active {
            border-color: #22c55e;
            background: rgba(34, 197, 94, 0.3);
            color: #4ade80;
        }
        
        .mode-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Enable/Disable Toggle */
        .enable-toggle {
            position: relative;
            width: 44px;
            height: 24px;
            margin-right: 8px;
        }
        
        .enable-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .enable-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #475569;
            border-radius: 24px;
            transition: 0.3s;
        }
        
        .enable-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
        }
        
        .enable-toggle input:checked + .enable-slider {
            background: #22c55e;
        }
        
        .enable-toggle input:checked + .enable-slider:before {
            transform: translateX(20px);
        }
        
        /* Coins Grid */
        .coins-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .coin-btn {
            padding: 12px 8px;
            border: 1px solid #475569;
            border-radius: 10px;
            background: rgba(15, 23, 42, 0.6);
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        
        .coin-btn.active {
            border-color: #22c55e;
            background: rgba(34, 197, 94, 0.2);
        }
        
        .coin-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin: 0 auto 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            color: white;
        }
        
        .coin-name {
            font-size: 12px;
            font-weight: 600;
        }
        
        .coin-status {
            font-size: 10px;
            color: #64748b;
        }
        
        .coin-btn.active .coin-status {
            color: #22c55e;
        }
        
        /* Coin colors */
        .coin-btc { background: linear-gradient(135deg, #f7931a, #ffab40); }
        .coin-eth { background: linear-gradient(135deg, #627eea, #8c9eff); }
        .coin-bnb { background: linear-gradient(135deg, #f3ba2f, #ffd54f); }
        .coin-sol { background: linear-gradient(135deg, #9945ff, #14f195); }
        .coin-xrp { background: linear-gradient(135deg, #23292f, #546e7a); }
        .coin-ada { background: linear-gradient(135deg, #0033ad, #1e88e5); }
        .coin-doge { background: linear-gradient(135deg, #c2a633, #ffca28); }
        .coin-link { background: linear-gradient(135deg, #2a5ada, #5c6bc0); }
        .coin-avax { background: linear-gradient(135deg, #e84142, #ff5252); }
        
        /* Sliders */
        .slider-group {
            margin-bottom: 16px;
        }
        
        .slider-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .slider-label {
            font-size: 13px;
            color: #94a3b8;
        }
        
        .slider-value {
            font-size: 14px;
            font-weight: 600;
            color: #60a5fa;
        }
        
        .slider-wrapper {
            position: relative;
            height: 6px;
            background: #475569;
            border-radius: 3px;
        }
        
        .slider-fill {
            position: absolute;
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #06b6d4);
            border-radius: 3px;
        }
        
        .slider-wrapper input {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .slider-thumb {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background: #f1f5f9;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            pointer-events: none;
        }
        
        /* Warning */
        .warning-box {
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 10px;
            padding: 12px;
            margin-top: 12px;
            font-size: 12px;
            color: #f87171;
            display: flex;
            gap: 8px;
        }
        
        .warning-box.hidden {
            display: none;
        }
        
        .info-box {
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 10px;
            padding: 12px;
            margin-top: 12px;
            font-size: 12px;
            color: #60a5fa;
        }
        
        /* API Status Badge */
        .api-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .api-badge.ok {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
        }
        
        .api-badge.missing {
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }
        
        /* Summary before start */
        .summary-box {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid #475569;
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
        }
        
        .summary-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #94a3b8;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            padding: 6px 0;
            border-bottom: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .summary-row:last-child {
            border-bottom: none;
        }
        
        .summary-label {
            color: #94a3b8;
        }
        
        .summary-value {
            font-weight: 600;
        }
        
        .summary-value.signal {
            color: #fbbf24;
        }
        
        .summary-value.auto {
            color: #4ade80;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Header -->
        <div class="header">
            <div class="logo">ü§ñ</div>
            <h1>CryptoDen</h1>
            <p>AI Trading Bot</p>
        </div>
        
        <!-- Status Card -->
        <div class="status-card">
            <div class="status-row">
                <span class="status-dot" id="status-dot"></span>
                <span class="status-text" id="status-text">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
            <div class="status-info" id="status-info"></div>
            
            <button class="main-btn start" id="main-btn" onclick="handleMainAction()" disabled>
                üöÄ –ó–ê–ü–£–°–¢–ò–¢–¨
            </button>
        </div>
        
        <!-- Settings (only when stopped) -->
        <div id="settings-section">
        
            <!-- API Keys -->
            <div class="card" id="card-api">
                <div class="card-header" onclick="toggleCard('api')">
                    <div class="card-title">
                        <div class="card-icon">üîê</div>
                        <div>
                            <h3>API –ö–ª—é—á–∏ Bybit <span class="api-badge missing" id="api-badge">–ù–µ —É–∫–∞–∑–∞–Ω—ã</span></h3>
                            <div class="subtitle">–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ-—Ä–µ–∂–∏–º–æ–≤</div>
                        </div>
                    </div>
                    <div class="card-arrow">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="card-body">
                        <div class="input-group">
                            <label>API Key</label>
                            <div class="input-wrapper">
                                <input type="password" id="api-key" placeholder="–í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á">
                                <button class="input-toggle" onclick="togglePassword('api-key')">üëÅ</button>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>API Secret</label>
                            <div class="input-wrapper">
                                <input type="password" id="api-secret" placeholder="–í–≤–µ–¥–∏—Ç–µ Secret">
                                <button class="input-toggle" onclick="togglePassword('api-secret')">üëÅ</button>
                            </div>
                        </div>
                        <div class="toggle-row">
                            <button class="toggle-btn active" id="btn-testnet" onclick="setNetwork('testnet')">üß™ Testnet</button>
                            <button class="toggle-btn" id="btn-mainnet" onclick="setNetwork('mainnet')">üí∞ Mainnet</button>
                        </div>
                        
                        <div class="info-box">
                            ‚ÑπÔ∏è –ë–µ–∑ API –∫–ª—é—á–µ–π –≤—Å–µ –º–æ–¥—É–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ —Ä–µ–∂–∏–º–µ <b>–°–ò–ì–ù–ê–õ–û–í</b> ‚Äî –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ —Ç–æ—Ä–≥—É–µ—Ç–µ –≤—Ä—É—á–Ω—É—é.
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Module Modes -->
            <div class="card open" id="card-modules">
                <div class="card-header" onclick="toggleCard('modules')">
                    <div class="card-title">
                        <div class="card-icon">‚öôÔ∏è</div>
                        <div>
                            <h3>–†–µ–∂–∏–º—ã –º–æ–¥—É–ª–µ–π</h3>
                            <div class="subtitle" id="modules-summary">üì¢ –°–∏–≥–Ω–∞–ª—ã: 6 | ü§ñ –ê–≤—Ç–æ: 0</div>
                        </div>
                    </div>
                    <div class="card-arrow">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="card-body">
                        
                        <!-- Director AI -->
                        <div class="module-item">
                            <div class="module-info">
                                <label class="enable-toggle">
                                    <input type="checkbox" id="module-director-enabled" checked onchange="updateModule('director')">
                                    <span class="enable-slider"></span>
                                </label>
                                <div>
                                    <div class="module-icon">üé©</div>
                                </div>
                                <div>
                                    <div class="module-name">Director AI</div>
                                    <div class="module-desc">–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è</div>
                                </div>
                            </div>
                            <div class="mode-toggle">
                                <button class="mode-btn active" id="director-signal" onclick="setModuleMode('director', 'signal')">üì¢</button>
                                <button class="mode-btn auto" id="director-auto" onclick="setModuleMode('director', 'auto')">ü§ñ</button>
                            </div>
                        </div>
                        
                        <!-- Grid Bot -->
                        <div class="module-item">
                            <div class="module-info">
                                <label class="enable-toggle">
                                    <input type="checkbox" id="module-grid-enabled" checked onchange="updateModule('grid')">
                                    <span class="enable-slider"></span>
                                </label>
                                <div>
                                    <div class="module-icon">üìä</div>
                                </div>
                                <div>
                                    <div class="module-name">Grid Bot</div>
                                    <div class="module-desc">–°–µ—Ç–∫–∞ –æ—Ä–¥–µ—Ä–æ–≤</div>
                                </div>
                            </div>
                            <div class="mode-toggle">
                                <button class="mode-btn active" id="grid-signal" onclick="setModuleMode('grid', 'signal')">üì¢</button>
                                <button class="mode-btn auto" id="grid-auto" onclick="setModuleMode('grid', 'auto')">ü§ñ</button>
                            </div>
                        </div>
                        
                        <!-- Funding Scalper -->
                        <div class="module-item">
                            <div class="module-info">
                                <label class="enable-toggle">
                                    <input type="checkbox" id="module-funding-enabled" checked onchange="updateModule('funding')">
                                    <span class="enable-slider"></span>
                                </label>
                                <div>
                                    <div class="module-icon">üí∞</div>
                                </div>
                                <div>
                                    <div class="module-name">Funding Scalper</div>
                                    <div class="module-desc">Funding Rate –∞—Ä–±–∏—Ç—Ä–∞–∂</div>
                                </div>
                            </div>
                            <div class="mode-toggle">
                                <button class="mode-btn active" id="funding-signal" onclick="setModuleMode('funding', 'signal')">üì¢</button>
                                <button class="mode-btn auto" id="funding-auto" onclick="setModuleMode('funding', 'auto')">ü§ñ</button>
                            </div>
                        </div>
                        
                        <!-- Arbitrage -->
                        <div class="module-item">
                            <div class="module-info">
                                <label class="enable-toggle">
                                    <input type="checkbox" id="module-arbitrage-enabled" onchange="updateModule('arbitrage')">
                                    <span class="enable-slider"></span>
                                </label>
                                <div>
                                    <div class="module-icon">üîÑ</div>
                                </div>
                                <div>
                                    <div class="module-name">Arbitrage</div>
                                    <div class="module-desc">–¢—Ä–µ—É–≥–æ–ª—å–Ω—ã–π –∞—Ä–±–∏—Ç—Ä–∞–∂</div>
                                </div>
                            </div>
                            <div class="mode-toggle">
                                <button class="mode-btn active" id="arbitrage-signal" onclick="setModuleMode('arbitrage', 'signal')">üì¢</button>
                                <button class="mode-btn auto" id="arbitrage-auto" onclick="setModuleMode('arbitrage', 'auto')">ü§ñ</button>
                            </div>
                        </div>
                        
                        <!-- Listing Hunter -->
                        <div class="module-item">
                            <div class="module-info">
                                <label class="enable-toggle">
                                    <input type="checkbox" id="module-listing-enabled" checked onchange="updateModule('listing')">
                                    <span class="enable-slider"></span>
                                </label>
                                <div>
                                    <div class="module-icon">üÜï</div>
                                </div>
                                <div>
                                    <div class="module-name">Listing Hunter</div>
                                    <div class="module-desc">–û—Ö–æ—Ç–∞ –∑–∞ –ª–∏—Å—Ç–∏–Ω–≥–∞–º–∏</div>
                                </div>
                            </div>
                            <div class="mode-toggle">
                                <button class="mode-btn active" id="listing-signal" onclick="setModuleMode('listing', 'signal')">üì¢</button>
                                <button class="mode-btn auto" id="listing-auto" onclick="setModuleMode('listing', 'auto')">ü§ñ</button>
                            </div>
                        </div>
                        
                        <!-- Worker (RSI) -->
                        <div class="module-item">
                            <div class="module-info">
                                <label class="enable-toggle">
                                    <input type="checkbox" id="module-worker-enabled" checked onchange="updateModule('worker')">
                                    <span class="enable-slider"></span>
                                </label>
                                <div>
                                    <div class="module-icon">üë∑</div>
                                </div>
                                <div>
                                    <div class="module-name">RSI Strategy</div>
                                    <div class="module-desc">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã</div>
                                </div>
                            </div>
                            <div class="mode-toggle">
                                <button class="mode-btn active" id="worker-signal" onclick="setModuleMode('worker', 'signal')">üì¢</button>
                                <button class="mode-btn auto" id="worker-auto" onclick="setModuleMode('worker', 'auto')">ü§ñ</button>
                            </div>
                        </div>
                        
                        <div class="info-box" id="auto-warning" style="display:none;">
                            ‚ö†Ô∏è –î–ª—è –∞–≤—Ç–æ-—Ä–µ–∂–∏–º–æ–≤ —Ç—Ä–µ–±—É—é—Ç—Å—è API –∫–ª—é—á–∏ Bybit!
                        </div>
                        
                    </div>
                </div>
            </div>
            
            <!-- Coins -->
            <div class="card" id="card-coins">
                <div class="card-header" onclick="toggleCard('coins')">
                    <div class="card-title">
                        <div class="card-icon">ü™ô</div>
                        <div>
                            <h3>–ú–æ–Ω–µ—Ç—ã</h3>
                            <div class="subtitle" id="coins-count">–í—ã–±—Ä–∞–Ω–æ: 7 –∏–∑ 9</div>
                        </div>
                    </div>
                    <div class="card-arrow">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="card-body">
                        <div class="coins-grid" id="coins-grid"></div>
                    </div>
                </div>
            </div>
            
            <!-- Risk Management -->
            <div class="card" id="card-risk">
                <div class="card-header" onclick="toggleCard('risk')">
                    <div class="card-title">
                        <div class="card-icon">üìä</div>
                        <div>
                            <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏</h3>
                            <div class="subtitle">–î–ª—è –∞–≤—Ç–æ-—Ä–µ–∂–∏–º–æ–≤</div>
                        </div>
                    </div>
                    <div class="card-arrow">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="card-body">
                        <div class="slider-group">
                            <div class="slider-header">
                                <span class="slider-label">–†–∞–∑–º–µ—Ä —Å–¥–µ–ª–∫–∏</span>
                                <span class="slider-value" id="risk-value">15%</span>
                            </div>
                            <div class="slider-wrapper">
                                <div class="slider-fill" id="risk-fill" style="width:50%"></div>
                                <div class="slider-thumb" id="risk-thumb" style="left:50%"></div>
                                <input type="range" id="risk-slider" min="5" max="25" value="15" oninput="updateSlider('risk')">
                            </div>
                        </div>
                        <div class="slider-group">
                            <div class="slider-header">
                                <span class="slider-label">–ú–∞–∫—Å. —Å–¥–µ–ª–æ–∫ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ</span>
                                <span class="slider-value" id="trades-value">6</span>
                            </div>
                            <div class="slider-wrapper">
                                <div class="slider-fill" id="trades-fill" style="width:55%"></div>
                                <div class="slider-thumb" id="trades-thumb" style="left:55%"></div>
                                <input type="range" id="trades-slider" min="1" max="10" value="6" oninput="updateSlider('trades')">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- AI Settings -->
            <div class="card" id="card-ai">
                <div class="card-header" onclick="toggleCard('ai')">
                    <div class="card-title">
                        <div class="card-icon">üß†</div>
                        <div>
                            <h3>AI –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                            <div class="subtitle">Claude Sonnet –∞–Ω–∞–ª–∏–∑</div>
                        </div>
                    </div>
                    <div class="card-arrow">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="card-body">
                        <div class="toggle-row">
                            <button class="toggle-btn active" id="btn-ai-on" onclick="setAI(true)">‚úÖ AI –í–∫–ª—é—á—ë–Ω</button>
                            <button class="toggle-btn" id="btn-ai-off" onclick="setAI(false)">‚ùå –ë–µ–∑ AI</button>
                        </div>
                        <div class="slider-group" style="margin-top:16px;">
                            <div class="slider-header">
                                <span class="slider-label">–ú–∏–Ω. —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å AI</span>
                                <span class="slider-value" id="confidence-value">60%</span>
                            </div>
                            <div class="slider-wrapper">
                                <div class="slider-fill" id="confidence-fill" style="width:50%"></div>
                                <div class="slider-thumb" id="confidence-thumb" style="left:50%"></div>
                                <input type="range" id="confidence-slider" min="30" max="90" value="60" oninput="updateSlider('confidence')">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Summary -->
            <div class="summary-box" id="summary-box">
                <div class="summary-title">üìã –ò—Ç–æ–≥–æ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:</div>
                <div id="summary-content"></div>
            </div>
            
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        let botRunning = false;
        let hasApiKeys = false;
        
        // Settings
        let settings = {
            bybit_api_key: "",
            bybit_api_secret: "",
            bybit_testnet: true,
            
            modules: {
                director: { enabled: true, mode: "signal" },
                grid: { enabled: true, mode: "signal" },
                funding: { enabled: true, mode: "signal" },
                arbitrage: { enabled: false, mode: "signal" },
                listing: { enabled: true, mode: "signal" },
                worker: { enabled: true, mode: "signal" }
            },
            
            coins: {
                BTC: true, ETH: true, BNB: true,
                SOL: true, XRP: true, ADA: true,
                DOGE: true, LINK: false, AVAX: false
            },
            
            risk_percent: 15,
            max_trades: 6,
            ai_enabled: true,
            ai_confidence: 60
        };
        
        const coinsData = [
            { id: 'BTC', name: 'Bitcoin', color: 'coin-btc' },
            { id: 'ETH', name: 'Ethereum', color: 'coin-eth' },
            { id: 'BNB', name: 'BNB', color: 'coin-bnb' },
            { id: 'SOL', name: 'Solana', color: 'coin-sol' },
            { id: 'XRP', name: 'Ripple', color: 'coin-xrp' },
            { id: 'ADA', name: 'Cardano', color: 'coin-ada' },
            { id: 'DOGE', name: 'Doge', color: 'coin-doge' },
            { id: 'LINK', name: 'Chainlink', color: 'coin-link' },
            { id: 'AVAX', name: 'Avalanche', color: 'coin-avax' }
        ];
        
        // ============ STATUS ============
        async function checkBotStatus() {
            try {
                const resp = await fetch('/api/bot-status');
                const data = await resp.json();
                botRunning = data.running;
                updateUI();
            } catch (e) {
                botRunning = false;
                updateUI();
            }
        }
        
        function updateUI() {
            const dot = document.getElementById('status-dot');
            const text = document.getElementById('status-text');
            const info = document.getElementById('status-info');
            const btn = document.getElementById('main-btn');
            const settingsSection = document.getElementById('settings-section');
            
            if (botRunning) {
                dot.classList.add('running');
                text.textContent = '–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç';
                info.innerHTML = '<span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ Telegram</span>';
                btn.className = 'main-btn stop';
                btn.textContent = 'üõë –û–°–¢–ê–ù–û–í–ò–¢–¨';
                btn.disabled = false;
                settingsSection.style.display = 'none';
            } else {
                dot.classList.remove('running');
                text.textContent = '–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
                info.innerHTML = '<span>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ</span>';
                btn.className = 'main-btn start';
                btn.textContent = 'üöÄ –ó–ê–ü–£–°–¢–ò–¢–¨';
                btn.disabled = false;
                settingsSection.style.display = 'block';
            }
            
            updateSummary();
        }
        
        // ============ MAIN ACTION ============
        async function handleMainAction() {
            const btn = document.getElementById('main-btn');
            btn.disabled = true;
            btn.textContent = botRunning ? '‚è≥ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é...' : '‚è≥ –ó–∞–ø—É—Å–∫–∞—é...';
            
            // –°–æ–±–∏—Ä–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            collectSettings();
            
            try {
                if (botRunning) {
                    await fetch('/api/stop', { method: 'POST' });
                } else {
                    await fetch('/api/start', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(settings)
                    });
                }
                
                btn.textContent = '‚úÖ –ì–æ—Ç–æ–≤–æ!';
                setTimeout(() => tg.close(), 500);
                
            } catch (e) {
                alert('–û—à–∏–±–∫–∞: ' + e.message);
                checkBotStatus();
            }
        }
        
        function collectSettings() {
            settings.bybit_api_key = document.getElementById('api-key').value;
            settings.bybit_api_secret = document.getElementById('api-secret').value;
        }
        
        // ============ API KEYS ============
        function updateApiStatus() {
            const key = document.getElementById('api-key').value;
            const secret = document.getElementById('api-secret').value;
            const badge = document.getElementById('api-badge');
            const warning = document.getElementById('auto-warning');
            
            hasApiKeys = key.length > 10 && secret.length > 10;
            
            if (hasApiKeys) {
                badge.textContent = '‚úì OK';
                badge.className = 'api-badge ok';
                warning.style.display = 'none';
            } else {
                badge.textContent = '–ù–µ —É–∫–∞–∑–∞–Ω—ã';
                badge.className = 'api-badge missing';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –∞–≤—Ç–æ-—Ä–µ–∂–∏–º—ã
                const hasAuto = Object.values(settings.modules).some(m => m.enabled && m.mode === 'auto');
                warning.style.display = hasAuto ? 'block' : 'none';
            }
            
            updateModuleButtons();
            updateSummary();
        }
        
        function togglePassword(id) {
            const input = document.getElementById(id);
            input.type = input.type === 'password' ? 'text' : 'password';
        }
        
        function setNetwork(network) {
            document.getElementById('btn-testnet').classList.toggle('active', network === 'testnet');
            document.getElementById('btn-mainnet').classList.toggle('active', network === 'mainnet');
            settings.bybit_testnet = network === 'testnet';
        }
        
        // ============ MODULES ============
        function setModuleMode(module, mode) {
            // –ï—Å–ª–∏ –Ω–µ—Ç API –∏ –ø—ã—Ç–∞–µ—Ç—Å—è –≤–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ–º
            if (mode === 'auto' && !hasApiKeys) {
                alert('‚ö†Ô∏è –î–ª—è –∞–≤—Ç–æ-—Ä–µ–∂–∏–º–∞ –Ω—É–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ API –∫–ª—é—á–∏ Bybit');
                return;
            }
            
            settings.modules[module].mode = mode;
            
            // UI
            document.getElementById(`${module}-signal`).classList.toggle('active', mode === 'signal');
            document.getElementById(`${module}-auto`).classList.toggle('active', mode === 'auto');
            
            updateModulesSummary();
            updateSummary();
        }
        
        function updateModule(module) {
            const enabled = document.getElementById(`module-${module}-enabled`).checked;
            settings.modules[module].enabled = enabled;
            
            // Disable mode buttons if module disabled
            const signalBtn = document.getElementById(`${module}-signal`);
            const autoBtn = document.getElementById(`${module}-auto`);
            
            signalBtn.disabled = !enabled;
            autoBtn.disabled = !enabled;
            signalBtn.style.opacity = enabled ? '1' : '0.3';
            autoBtn.style.opacity = enabled ? '1' : '0.3';
            
            updateModulesSummary();
            updateSummary();
        }
        
        function updateModuleButtons() {
            // Disable auto buttons if no API keys
            Object.keys(settings.modules).forEach(module => {
                const autoBtn = document.getElementById(`${module}-auto`);
                if (!hasApiKeys) {
                    autoBtn.disabled = true;
                    autoBtn.style.opacity = '0.3';
                    
                    // Reset to signal if was auto
                    if (settings.modules[module].mode === 'auto') {
                        setModuleMode(module, 'signal');
                    }
                } else {
                    const enabled = settings.modules[module].enabled;
                    autoBtn.disabled = !enabled;
                    autoBtn.style.opacity = enabled ? '1' : '0.3';
                }
            });
        }
        
        function updateModulesSummary() {
            let signalCount = 0;
            let autoCount = 0;
            
            Object.values(settings.modules).forEach(m => {
                if (m.enabled) {
                    if (m.mode === 'signal') signalCount++;
                    else autoCount++;
                }
            });
            
            document.getElementById('modules-summary').textContent = 
                `üì¢ –°–∏–≥–Ω–∞–ª—ã: ${signalCount} | ü§ñ –ê–≤—Ç–æ: ${autoCount}`;
            
            // Show warning if auto without API
            const warning = document.getElementById('auto-warning');
            warning.style.display = (autoCount > 0 && !hasApiKeys) ? 'block' : 'none';
        }
        
        // ============ COINS ============
        function renderCoins() {
            const grid = document.getElementById('coins-grid');
            let count = 0;
            
            grid.innerHTML = coinsData.map(coin => {
                const active = settings.coins[coin.id];
                if (active) count++;
                return `
                    <button class="coin-btn ${active ? 'active' : ''}" onclick="toggleCoin('${coin.id}')">
                        <div class="coin-icon ${coin.color}">${coin.id[0]}</div>
                        <div class="coin-name">${coin.id}</div>
                        <div class="coin-status">${active ? '‚úì' : '‚Äî'}</div>
                    </button>
                `;
            }).join('');
            
            document.getElementById('coins-count').textContent = `–í—ã–±—Ä–∞–Ω–æ: ${count} –∏–∑ ${coinsData.length}`;
        }
        
        function toggleCoin(id) {
            settings.coins[id] = !settings.coins[id];
            renderCoins();
            updateSummary();
        }
        
        // ============ SLIDERS ============
        function updateSlider(type) {
            const slider = document.getElementById(`${type}-slider`);
            const value = parseInt(slider.value);
            const min = parseInt(slider.min);
            const max = parseInt(slider.max);
            const percent = ((value - min) / (max - min)) * 100;
            
            document.getElementById(`${type}-fill`).style.width = percent + '%';
            document.getElementById(`${type}-thumb`).style.left = percent + '%';
            
            if (type === 'risk') {
                document.getElementById('risk-value').textContent = value + '%';
                settings.risk_percent = value;
            } else if (type === 'trades') {
                document.getElementById('trades-value').textContent = value;
                settings.max_trades = value;
            } else if (type === 'confidence') {
                document.getElementById('confidence-value').textContent = value + '%';
                settings.ai_confidence = value;
            }
        }
        
        // ============ AI ============
        function setAI(enabled) {
            document.getElementById('btn-ai-on').classList.toggle('active', enabled);
            document.getElementById('btn-ai-off').classList.toggle('active', !enabled);
            settings.ai_enabled = enabled;
        }
        
        // ============ CARDS ============
        function toggleCard(id) {
            document.getElementById('card-' + id).classList.toggle('open');
        }
        
        // ============ SUMMARY ============
        function updateSummary() {
            const content = document.getElementById('summary-content');
            
            const modulesMap = {
                director: 'üé© Director',
                grid: 'üìä Grid Bot',
                funding: 'üí∞ Funding',
                arbitrage: 'üîÑ Arbitrage',
                listing: 'üÜï Listing',
                worker: 'üë∑ RSI'
            };
            
            let html = '';
            
            // –ú–æ–¥—É–ª–∏
            Object.entries(settings.modules).forEach(([key, val]) => {
                if (val.enabled) {
                    const modeClass = val.mode === 'auto' ? 'auto' : 'signal';
                    const modeText = val.mode === 'auto' ? 'ü§ñ –ê–≤—Ç–æ' : 'üì¢ –°–∏–≥–Ω–∞–ª';
                    html += `
                        <div class="summary-row">
                            <span class="summary-label">${modulesMap[key]}</span>
                            <span class="summary-value ${modeClass}">${modeText}</span>
                        </div>
                    `;
                }
            });
            
            // –ú–æ–Ω–µ—Ç—ã
            const coinsList = Object.entries(settings.coins)
                .filter(([k, v]) => v)
                .map(([k]) => k)
                .join(', ');
            
            html += `
                <div class="summary-row">
                    <span class="summary-label">–ú–æ–Ω–µ—Ç—ã</span>
                    <span class="summary-value">${coinsList || '–ù–µ –≤—ã–±—Ä–∞–Ω—ã'}</span>
                </div>
            `;
            
            // AI
            html += `
                <div class="summary-row">
                    <span class="summary-label">AI –∞–Ω–∞–ª–∏–∑</span>
                    <span class="summary-value">${settings.ai_enabled ? '‚úÖ –í–∫–ª' : '‚ùå –í—ã–∫–ª'}</span>
                </div>
            `;
            
            // API
            html += `
                <div class="summary-row">
                    <span class="summary-label">API Bybit</span>
                    <span class="summary-value ${hasApiKeys ? 'auto' : 'signal'}">${hasApiKeys ? '‚úÖ –ü–æ–¥–∫–ª—é—á—ë–Ω' : '‚ùå –ù–µ—Ç'}</span>
                </div>
            `;
            
            content.innerHTML = html;
        }
        
        // ============ INIT ============
        async function init() {
            // Load saved settings
            try {
                const resp = await fetch('/api/settings');
                if (resp.ok) {
                    const data = await resp.json();
                    settings = { ...settings, ...data };
                    
                    // Apply to UI
                    document.getElementById('api-key').value = settings.bybit_api_key || '';
                    document.getElementById('api-secret').value = settings.bybit_api_secret || '';
                    setNetwork(settings.bybit_testnet ? 'testnet' : 'mainnet');
                    
                    // Modules
                    Object.entries(settings.modules).forEach(([module, config]) => {
                        document.getElementById(`module-${module}-enabled`).checked = config.enabled;
                        document.getElementById(`${module}-signal`).classList.toggle('active', config.mode === 'signal');
                        document.getElementById(`${module}-auto`).classList.toggle('active', config.mode === 'auto');
                        updateModule(module);
                    });
                    
                    // Sliders
                    document.getElementById('risk-slider').value = settings.risk_percent;
                    document.getElementById('trades-slider').value = settings.max_trades;
                    document.getElementById('confidence-slider').value = settings.ai_confidence;
                    updateSlider('risk');
                    updateSlider('trades');
                    updateSlider('confidence');
                    
                    setAI(settings.ai_enabled);
                }
            } catch (e) {
                console.log('Using defaults');
            }
            
            updateApiStatus();
            renderCoins();
            updateModulesSummary();
            checkBotStatus();
        }
        
        // Event listeners
        document.getElementById('api-key').addEventListener('input', updateApiStatus);
        document.getElementById('api-secret').addEventListener('input', updateApiStatus);
        
        // Start
        init();
        setInterval(checkBotStatus, 5000);
    </script>
</body>
</html>
